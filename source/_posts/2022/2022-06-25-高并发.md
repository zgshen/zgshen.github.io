---
title: 高并发
categories: 技术
tags: 
  - 技术
date: 2022-06-23
toc: true
---


高并发应该是面试的时候很多面试官很喜欢问的问题，虽然很多公司的业务根本就没有高并发的场景。如果要聊一下高并发的问题，首先要明确我们最终的目的是保证系统能稳定运行、快速响应，然后我们需要采取什么方案来实现。

一个系统不管并发高不高，最终我们的目的是要保证系统能稳定运行、快速响应，在解决高并发问题的时候要找出系统的瓶颈在哪，然后再对症下药。

### 基础概念

首先要说一下一些基本概念，并发是系统在一段时间内可以处理多个任务，在短时间内cpu交替执行，以达到接近可以同时处理多任务的效果。与之区别的是并行，指系统可以同时处理多个任务。任务同时进行，不抢占cpu，不需要线程切换。

QPS每秒查询率(Query Per Second)是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。QPS和并发数的关系可以简单用公式表示：

```
QPS（TPS）= 并发数/平均响应时间 
或者 
并发数 = QPS*平均响应时间
```

- 系统压力小的时候，并发数和 QPS 呈正相关，比如此时响应时间都小于1秒； 
- 当系统压力大的时候，比如响应时间远大于1秒，QPS 可能会趋向最大值或反而会下降。

内网测试一般接口100ms以内，简单的接口可以做到50ms以内。响应时间当然是越快越好，但是实际到公网，由于网络波动和物理距离，就会差了很多，波动很大，这里只讨论内网稳定的网络环境。

项目在做系统设计的时候都会定一个预期目标，比如接口三千QPS，响应时间在一秒以内，以支撑较高的并发，要达到这个目标，就需要系统的各层做好设计。以一个页面请求和页面包括的接口从前端到后端应用，再到数据库的调用流程作为例子，分析各个环节可以使用哪些技术来支撑高并发。

### 前端

前端总体来讲可以分为静态资源和来自后端接口的数据。

- 做前后端分离，各自单独部署，互不影响；
- CSS样式文件和JavaScript脚本，还有图片等等资源可以做缓存，现代浏览器对get请求都会做缓存。还可以使用CDN，将静态资源分发到CDN网络中，减小源服务器的压力；
- 如果用到Nginx，可以开启gzip压缩
- localStorage缓存数据（业务范畴）

### 服务器端

https://xie.infoq.cn/article/20c3ad1736d027615b12d6b20

