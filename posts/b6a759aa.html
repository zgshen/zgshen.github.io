<!DOCTYPE html>
<html>
  <!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  
  <title>ssh 登录远程服务器很慢原因 - zguishen&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  
  <meta name="keywords" content=基础>
  
    <meta name="description" content="zgshen,zguishen,甘甘">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.02">
  
  
    <link rel="alternate" href="/atom.xml " title="zguishen&#39;s blog" type="application/atom+xml">
  

  
<link rel="stylesheet" href="/css/style.css">

  <!-- <script data-ad-client="ca-pub-2187290877628564" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js"></script>
  <script>
    pangu.spacingElementByClassName('post');
    document.addEventListener('DOMContentLoaded', () => {
      // listen to any DOM change and automatically perform spacing via MutationObserver()
      pangu.autoSpacingPage();
    });
  </script>
<meta name="generator" content="Hexo 6.2.0"></head>
  <body>
    <div class="container">
      <article class="post">
  <div class="post-title">
    <h1 class="article-title">ssh 登录远程服务器很慢原因</h1>
  </div>
   <div class="post-meta">
    <span class="post-time">2021-08-18</span>
  </div>
  <div class="post-content">
    
	
    <p>在远程服务器添加客户端的公钥之后，在 <code>~/.ssh/config</code> 文件中配置如下远程服务器链接后就能，通过命令 <code>ssh 服务器名</code> 登录远程服务器了，比如这里就是 <code>ssh tx</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ssh 远程机器配置</span></span><br><span class="line"><span class="comment">#腾讯云</span></span><br><span class="line">Host tx</span><br><span class="line">HostName xxx.xxx.xxx.xxx</span><br><span class="line">User root</span><br><span class="line">Port 22</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line"><span class="comment"># 公钥默认文件名就是这个，IdentityFile 配置可以省略，如果文件是别的名称就指定下</span></span><br></pre></td></tr></table></figure>

<p>但是有个问题就是，登录的时候总要要等个 20 来秒才连接上，这是什么原因呢</p>
<p>使用 <code>ssh -v tx</code> 可以看登录的日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">debug1: SSH2_MSG_SERVICE_ACCEPT received</span><br><span class="line">debug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password</span><br><span class="line">debug1: Next authentication method: gssapi-with-mic</span><br><span class="line">debug1: Unspecified GSS failure.  Minor code may provide more information</span><br><span class="line">No Kerberos credentials available (default cache: FILE:/tmp/krb5cc_1000)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">debug1: Unspecified GSS failure.  Minor code may provide more information</span><br><span class="line">No Kerberos credentials available (default cache: FILE:/tmp/krb5cc_1000)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">debug1: Next authentication method: publickey</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>登录的时候首先会尝试去使用 gssapi-with-mic 的方式，然后这里卡了 20 多秒失败了，之后才会去用 publickey 的方式登录上去。</p>
<p>看看 ssh config 文档怎么说的，<code>man ssh_config</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PreferredAuthentications</span><br><span class="line">    Specifies the order in which the client should try authentication methods.  This allows a client to prefer one method (e.g.</span><br><span class="line">    keyboard-interactive) over another method (e.g. password).  The default is:</span><br><span class="line"></span><br><span class="line">        gssapi-with-mic,hostbased,publickey,</span><br><span class="line">        keyboard-interactive,password</span><br><span class="line"></span><br><span class="line"># 指定客户端尝试进行身份认证的方式。允许客服端优先选择一种方式比如（键盘输入），而不是另一种方式（比如密码）。默认方式有：...</span><br></pre></td></tr></table></figure>

<p>所以，在 config 文件中指定 PreferredAuthentications 的优先选择的验证方式就好了，秒进。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#ssh 远程机器配置</span><br><span class="line">#腾讯云</span><br><span class="line">Host tx</span><br><span class="line">HostName xxx.xxx.xxx.xxx</span><br><span class="line">User root</span><br><span class="line">Port 22</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line">PreferredAuthentications publickey</span><br></pre></td></tr></table></figure>



  </div>
  <div class="post-footer">
    
      <ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li></ul>
    

    <a href="#top" class="top">返回顶部</a>
  </div>
</article>
<footer>
  &copy; 2022
  <span class="author">
    zguishen
  </span>
   / Documentation licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.
  </span>
</footer>
    </div>
  </body>
</html>