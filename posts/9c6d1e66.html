<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="zgshen,zguishen,甘甘"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@licorice128"><meta name="twitter:title" content="Java21 特性"><meta name="twitter:image" content="https://zguishen.com/images/blog/avatar.jpeg"><title>Java21 特性 | zguishen's blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java21 特性</h1><a id="logo" href="/.">zguishen's blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/kindle/"><i class="fa fa-book"> Kindle</i></a><a target="_blank" rel="noopener" href="https://gallery.zguishen.com"><i class="fa fa-image"> Gallery</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Java21 特性</h1><div class="post-meta">2023-10-23<span> | </span><span class="category"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%BC%8F%E7%89%B9%E6%80%A7"><span class="toc-number">1.</span> <span class="toc-text">正式特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sequenced-Collections-%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88"><span class="toc-number">1.1.</span> <span class="toc-text">Sequenced Collections | 有序集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Virtual-Threads-%E8%99%9A%E6%8B%9F%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">Virtual Threads 虚拟线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Record-Patterns-%E8%AE%B0%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">Record Patterns | 记录模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pattern-Matching-for-switch-switch-%E7%9A%84%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-number">1.4.</span> <span class="toc-text">Pattern Matching for switch | switch 的模式匹配</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E8%A7%88%E7%89%B9%E6%80%A7"><span class="toc-number">2.</span> <span class="toc-text">预览特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#String-Templates-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A8%A1%E6%9D%BF"><span class="toc-number">2.1.</span> <span class="toc-text">String Templates | 字符串模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unnamed-Patterns-and-Variables-%E6%9C%AA%E5%91%BD%E5%90%8D%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%8F%98%E9%87%8F"><span class="toc-number">2.2.</span> <span class="toc-text">Unnamed Patterns and Variables | 未命名模式和变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unanmed-class-and-instance-Main-method-%E6%9C%AA%E5%91%BD%E5%90%8D%E7%B1%BB%E5%92%8C%E5%AE%9E%E4%BE%8B%E7%9A%84-Main-%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.</span> <span class="toc-text">Unanmed class and instance Main method 未命名类和实例的 | Main 方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">3.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="post-content"><p>长期支持版的 Java21 在 9 月 19 日发布了，看一下有哪些新特性，主要看看正式加入的特性，预览特性就浏览一遍就行了，毕竟预览特性随时都会变化的。</p>
<h2 id="正式特性"><a href="#正式特性" class="headerlink" title="正式特性"></a>正式特性</h2><h3 id="Sequenced-Collections-有序集合"><a href="#Sequenced-Collections-有序集合" class="headerlink" title="Sequenced Collections | 有序集合"></a>Sequenced Collections | 有序集合</h3><p>Java 的集合框架缺少一种能够表示具有定义好的排列顺序的元素序列（比如 List 和 Deque 等）的集合类型，以及对这类集合的操作集。</p>
<p>来看看以前获取序列元素的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getCollectionElementTest</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; list = List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    list.get(<span class="number">0</span>);</span><br><span class="line">    list.get(list.size() - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    Deque&lt;Integer&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(list);</span><br><span class="line">    deque.getFirst();</span><br><span class="line">    deque.getLast();</span><br><span class="line"></span><br><span class="line">    SortedSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(list);</span><br><span class="line">    set.getFirst();</span><br><span class="line">    set.getLast();</span><br><span class="line"></span><br><span class="line">    LinkedHashSet&lt;Integer&gt; linkList = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(list);</span><br><span class="line">    Iterator&lt;Integer&gt; iterator = linkList.iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想要拿到序列的第一个元素和最后一个元素，列表使用下标直接获取，队列和有序集合有另外的实现方法，链表就只能遍历获取了，没有一个集合接口来归类这类有顺序的序列，具体的获取元素的操作方法也各不相同。</p>
<p>为了解决这些问题引入了 <code>SequencedCollection</code> 接口，此接口继承自 <code>Collection</code> 接口，具体可以看下图：<br><img src="https://cr.openjdk.org/~smarks/collections/SequencedCollectionDiagram20220216.png" alt="JEP 431: Sequenced Collections"></p>
<p><code>List</code> 和 <code>Deque</code> 接口实现了<code>SequencedCollection</code> 接口；<code>SortedMap</code> 和<code>LinkedHashMap</code> 实现了<code>SequencedMap</code> 接口。现在列表和链表都能使用统一的方式获取首尾元素了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getCollectionElementNewTest</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; list = List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">    list.getFirst();</span><br><span class="line">    list.getLast();</span><br><span class="line"></span><br><span class="line">    LinkedHashSet&lt;Integer&gt; linkList = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(list);</span><br><span class="line">    linkList.getFirst();</span><br><span class="line">    linkList.getLast();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Virtual-Threads-虚拟线程"><a href="#Virtual-Threads-虚拟线程" class="headerlink" title="Virtual Threads 虚拟线程"></a>Virtual Threads 虚拟线程</h3><p>虚拟线程详细看还在预览的时候之前写过一篇文章<a href="https://zguishen.com/posts/8a666b01.html">《简单了解下 JDK19 预览版的 Virtual Threads》</a>，正式特性也没太大变化，之前写的测试用例都能正常跑通。</p>
<h3 id="Record-Patterns-记录模式"><a href="#Record-Patterns-记录模式" class="headerlink" title="Record Patterns | 记录模式"></a>Record Patterns | 记录模式</h3><p>Java16 开始新增了 record 类，新增的 Record Patterns 特性就是对 record 类的一些增强性操作，简化类型判断和类型转换流程，并且支持嵌套操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecordPatternsExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patternTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Point</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        printSum(p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 类型判断和转换，及获取值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printSum</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 跟普通类一样，传入对象再使用方法获取x和y的值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Point p) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> p.x();</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> p.y();</span><br><span class="line">            System.out.println(x+y);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *  简化操作</span></span><br><span class="line"><span class="comment">         *  定义传入对象声明参数类型，可在后续直接获取值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title function_">Point</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>) &#123;</span><br><span class="line">            System.out.println(x + y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nestTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ColoredPoint</span> <span class="variable">cp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColoredPoint</span>(<span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">1</span>, <span class="number">2</span>), ColInheritingor.BLUE);</span><br><span class="line">        printPointY(cp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printPointY</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> ColoredPoint coloredPoint) &#123;</span><br><span class="line">            <span class="keyword">if</span> (coloredPoint.p() != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(coloredPoint.p().y());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 可嵌套</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title function_">ColoredPoint</span><span class="params">(Point p, Color c)</span>) &#123;</span><br><span class="line">            System.out.println(p.y());</span><br><span class="line">            System.out.println(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">record</span> <span class="title class_">ColoredPoint</span><span class="params">(Point p, Color c)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123; RED, GREEN, BLUE&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">record</span> <span class="title class_">Point</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Point</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="comment">//this.x = x;</span></span><br><span class="line">        <span class="built_in">this</span>(x, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pattern-Matching-for-switch-switch-的模式匹配"><a href="#Pattern-Matching-for-switch-switch-的模式匹配" class="headerlink" title="Pattern Matching for switch | switch 的模式匹配"></a>Pattern Matching for switch | switch 的模式匹配</h3><p>这也是一个增强的特性，目的是扩展 switch 表达式的适用性。</p>
<p>看例子，先定义一些类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Person</span> permits Tom, Jack, Nathan &#123;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    Person(<span class="type">int</span> age) &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Tom</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Tom</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Jack</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Jack</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Nathan</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Nathan</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>判断用户是谁可以这么操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whenTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tom</span>(<span class="number">30</span>);</span><br><span class="line">    <span class="keyword">switch</span> (person) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="literal">null</span> -&gt; System.out.println(<span class="string">&quot;null!&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> Jack jack -&gt; System.out.println(<span class="string">&quot;I am jack&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> Tom tom</span><br><span class="line">                when tom.age == <span class="number">30</span> -&gt; System.out.println(<span class="string">&quot;Tom&#x27;s age is 30&quot;</span>);</span><br><span class="line">        <span class="keyword">default</span> -&gt; System.out.println(<span class="string">&quot;Who am i?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在以前我们需要用到 instanceof 来一个个判断 person 是谁，现在可以用 switch 的模式匹配来简化操作，甚至在 case 语句中还可以用 when 语句来对对象的属性做判断。</p>
<p>由于 Person 这里定义的是一个密闭类，即创建的对象只能是指定的几种类型，所以穷尽 case 之后的 default 可以省略。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">coverageTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Nathan</span>(<span class="number">29</span>);</span><br><span class="line">    <span class="keyword">switch</span> (person) &#123;</span><br><span class="line">        <span class="keyword">case</span> Tom tom -&gt; System.out.println(<span class="string">&quot;I am tom.&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> Jack jack -&gt; System.out.println(<span class="string">&quot;I am jack.&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> Nathan nathan -&gt; System.out.println(<span class="string">&quot;I am nathan.&quot;</span>);</span><br><span class="line">        <span class="comment">//default -&gt; ...</span></span><br><span class="line">        <span class="comment">//由于 Person 是一个密闭类，实现类只有固定的三个，</span></span><br><span class="line">        <span class="comment">//所以这里的三个 case 已经穷尽所有情况，可以不用加 default 分支。</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以和记录模式的搭配使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">MyPair</span>&lt;S,T&gt;(S fst, T snd)&#123;&#125;;</span><br><span class="line">    MyPair&lt;String, Integer&gt; akari = <span class="keyword">new</span> <span class="title class_">MyPair</span>&lt;&gt;(<span class="string">&quot;Akari&quot;</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (akari) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="literal">null</span> -&gt; System.out.println(<span class="string">&quot;null!&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="title function_">MyPair</span><span class="params">(<span class="keyword">var</span> name, <span class="keyword">var</span> age)</span> -&gt; System.out.printf(<span class="string">&quot;username:%s, user age:%d&quot;</span>, name, age);</span><br><span class="line">        <span class="keyword">default</span> -&gt; System.out.println(<span class="string">&quot;default&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="预览特性"><a href="#预览特性" class="headerlink" title="预览特性"></a>预览特性</h2><h3 id="String-Templates-字符串模板"><a href="#String-Templates-字符串模板" class="headerlink" title="String Templates | 字符串模板"></a>String Templates | 字符串模板</h3><p>对字符串的操作是日常开发的高配功能，Java12 带来了处理字符串的新方式。</p>
<p>字符串模板处理器类 STR 用于将表达式中的变量进行字符串插值，最后返回字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">STRTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;nathan&quot;</span>;</span><br><span class="line">    <span class="comment">// STR 模板处理器</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> STR.<span class="string">&quot;I am \&#123;name&#125;.&quot;</span>;</span><br><span class="line">    System.out.println(str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以内嵌表达式</span></span><br><span class="line">    <span class="type">int</span> a=<span class="number">10</span>, b=<span class="number">20</span>;</span><br><span class="line">    <span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    System.out.println(STR.<span class="string">&quot;\&#123;a&#125; + \&#123;b&#125; = \&#123;a+b&#125;&quot;</span>);</span><br><span class="line">    System.out.println(STR.<span class="string">&quot;Tody is \&#123;LocalDate.now()&#125;.&quot;</span>);</span><br><span class="line">    System.out.println(STR.<span class="string">&quot;\&#123;a++&#125;, \&#123;a++&#125;, \&#123;arr[0]&#125;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 Java15 已经可以定义多行文本块，字符串处理也能配合使用，看下面的多行模板表达式例子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mutilLineTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">version</span> <span class="operator">=</span> <span class="number">21</span>;</span><br><span class="line">    <span class="type">var</span> <span class="variable">str</span> <span class="operator">=</span> STR.<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &lt;html&gt;</span></span><br><span class="line"><span class="string">                &lt;body&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;Java \&#123;version&#125; is now available!&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/body&gt;</span></span><br><span class="line"><span class="string">            &lt;/html&gt;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了 STR 之外还有一个 FMT 模板处理器，它除了具备 STR 一样的插值功能外还能做左侧格式化处理。</p>
<p>对比以下 STR 和 FMT 的处理方式和输出。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">FMTTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Rectangle</span><span class="params">(String name, <span class="type">double</span> width, <span class="type">double</span> height)</span> &#123;</span><br><span class="line">        <span class="type">double</span> <span class="title function_">area</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> width * height;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Rectangle[] zone = <span class="keyword">new</span> <span class="title class_">Rectangle</span>[] &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="string">&quot;Alfa&quot;</span>, <span class="number">17.8</span>, <span class="number">31.4</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="string">&quot;Bravo&quot;</span>, <span class="number">9.6</span>, <span class="number">12.4</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="string">&quot;Charlie&quot;</span>, <span class="number">7.1</span>, <span class="number">11.23</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">strTable</span> <span class="operator">=</span> STR.<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Description  Width  Height  Area</span></span><br><span class="line"><span class="string">        \&#123;zone[0].name&#125;  \&#123;zone[0].width&#125;  \&#123;zone[0].height&#125;     \&#123;zone[0].area()&#125;</span></span><br><span class="line"><span class="string">        \&#123;zone[1].name&#125;  \&#123;zone[1].width&#125;  \&#123;zone[1].height&#125;     \&#123;zone[1].area()&#125;</span></span><br><span class="line"><span class="string">        \&#123;zone[2].name&#125;  \&#123;zone[2].width&#125;  \&#123;zone[2].height&#125;     \&#123;zone[2].area()&#125;</span></span><br><span class="line"><span class="string">        Total \&#123;zone[0].area() + zone[1].area() + zone[2].area()&#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fmtTable</span> <span class="operator">=</span> FMT.<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Description     Width    Height     Area</span></span><br><span class="line"><span class="string">        %-12s\&#123;zone[0].name&#125;  %7.2f\&#123;zone[0].width&#125;  %7.2f\&#123;zone[0].height&#125;     %7.2f\&#123;zone[0].area()&#125;</span></span><br><span class="line"><span class="string">        %-12s\&#123;zone[1].name&#125;  %7.2f\&#123;zone[1].width&#125;  %7.2f\&#123;zone[1].height&#125;     %7.2f\&#123;zone[1].area()&#125;</span></span><br><span class="line"><span class="string">        %-12s\&#123;zone[2].name&#125;  %7.2f\&#123;zone[2].width&#125;  %7.2f\&#123;zone[2].height&#125;     %7.2f\&#123;zone[2].area()&#125;</span></span><br><span class="line"><span class="string">        \&#123;&quot; &quot;.repeat(28)&#125; Total %7.2f\&#123;zone[0].area() + zone[1].area() + zone[2].area()&#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>;</span><br><span class="line">    System.out.println(strTable);</span><br><span class="line">    System.out.println(fmtTable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外还有一个 RAW 标准模板处理器，有待处理元数据可先用 RAW 写好模板，等拿到变量值再做插值。另外，为了保证安全，如果单纯写一个模板字符串会有检查错误。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">RAWTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Joan&quot;</span>;</span><br><span class="line">    <span class="comment">//String info = &quot;My name is \&#123;name&#125;.&quot;; //error</span></span><br><span class="line">    <span class="type">StringTemplate</span> <span class="variable">st</span> <span class="operator">=</span> RAW.<span class="string">&quot;My name is \&#123;name&#125;.&quot;</span>;</span><br><span class="line">    System.out.println(STR.process(st));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>模板处理器 STR 和 FMT 是功能接口 StringTemplate.Processor 的实例，实现该接口的​​抽象方法 process，该方法接受 StringTemplate 并返回一个对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">interfaceTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>, y = <span class="number">20</span>;</span><br><span class="line">    <span class="type">StringTemplate</span> <span class="variable">st</span> <span class="operator">=</span> RAW.<span class="string">&quot;\&#123;x&#125; plus \&#123;y&#125; equals \&#123;x + y&#125;&quot;</span>;</span><br><span class="line">    System.out.println(st.fragments());</span><br><span class="line">    System.out.println(st.values());</span><br><span class="line">    <span class="comment">//StringTemplate&#123; fragments = [ &quot;&quot;, &quot; plus &quot;, &quot; equals &quot;, &quot;&quot; ], values = [10, 20, 30] &#125;</span></span><br><span class="line">    <span class="comment">//输出两部分，一部分是字符串的各段和各段之间的插值占位</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现接口，组装数据的方法，如果自己要加料就可以在这里处理</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">INTER</span> <span class="operator">=</span> StringTemplate.Processor.of((StringTemplate _st) -&gt; &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        Iterator&lt;String&gt; fragIter = _st.fragments().iterator();</span><br><span class="line">        <span class="keyword">for</span> (Object value : _st.values()) &#123;</span><br><span class="line">            sb.append(fragIter.next());</span><br><span class="line">            sb.append(value);</span><br><span class="line">            sb.append(<span class="string">&quot;_&quot;</span>);<span class="comment">//加点东西看看</span></span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(fragIter.next());</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(INTER.<span class="string">&quot;\&#123;x&#125; plus \&#123;y&#125; equals \&#123;x + y&#125;&quot;</span>);</span><br><span class="line">    <span class="comment">//| 10 and 20 equals 30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Unnamed-Patterns-and-Variables-未命名模式和变量"><a href="#Unnamed-Patterns-and-Variables-未命名模式和变量" class="headerlink" title="Unnamed Patterns and Variables | 未命名模式和变量"></a>Unnamed Patterns and Variables | 未命名模式和变量</h3><p>这个特性主要是用来简化代码的，如果在代码中声明了变量但又用不上，可以用下划线 <code>_</code> 代替，在记录模式和平常的循环和异常处理代码块中能用到，需要注意的是别跟用下划线开头做变量混淆了。</p>
<p>在记录模式中的使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">record</span> <span class="title class_">Point</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123; &#125;</span><br><span class="line"><span class="keyword">record</span> <span class="title class_">User</span><span class="params">(Order order)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">record</span> <span class="title class_">Order</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unnamedPatternTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Point</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    unnamedPattern(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unnamedPattern</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">    <span class="comment">// 如果用不上某些变量可以省略写为 _</span></span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title function_">Point</span><span class="params">(<span class="type">int</span> x, _)</span>) &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;x value is:%d.&quot;</span>, x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// switch 也可以这么用</span></span><br><span class="line">    <span class="keyword">switch</span> (obj) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="title function_">User</span><span class="params">(_)</span> -&gt; System.out.printf(<span class="string">&quot;user object.&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="title function_">Point</span><span class="params">(_, _)</span> -&gt; System.out.println(<span class="string">&quot;point object.&quot;</span>);</span><br><span class="line">        <span class="keyword">default</span> -&gt; System.out.printf(<span class="string">&quot;default output.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在循环和异常处理代码块中的使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unnamedVariablesTest</span><span class="params">()</span> &#123;</span><br><span class="line">    Queue&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Integer _ : list) &#123;</span><br><span class="line">        sum += <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (list.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">_</span> <span class="operator">=</span> list.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">_</span> <span class="operator">=</span> sum;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Point</span> <span class="variable">_</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception _) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Unanmed-class-and-instance-Main-method-未命名类和实例的-Main-方法"><a href="#Unanmed-class-and-instance-Main-method-未命名类和实例的-Main-方法" class="headerlink" title="Unanmed class and instance Main method 未命名类和实例的 | Main 方法"></a>Unanmed class and instance Main method 未命名类和实例的 | Main 方法</h3><p>未命名类和实例的 Main 方法由于还是预览特性，IDEA 也还没有支持，可以用命令行来测试。</p>
<p>新建一个 Main.java 文件，编辑内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;Unanmed class and instance main method.&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>使用命令编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ~/app/jdk/jdk-21/bin/javac --release 21 --enable-preview Main.java</span><br><span class="line">Note: Main.java uses preview features of Java SE 21.</span><br><span class="line">Note: Recompile with -Xlint:preview <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ~/app/jdk/jdk-21/bin/java --enable-preview Main                   </span><br><span class="line">Unanmed class and instance main method.</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>[1] <a target="_blank" rel="noopener" href="https://openjdk.org/projects/jdk/21/">JDK 21</a></li>
<li>[2] <a target="_blank" rel="noopener" href="https://www.unlogged.io/post/all-you-need-to-know-about-java21">All you need to know about Java21</a></li>
</ul>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8A%80%E6%9C%AF/" rel="tag">技术</a></li></ul></div><div class="post-nav"><a class="pre" href="/posts/8ae8faa8.html">Attack on Titan | 進撃の巨人</a><a class="next" href="/posts/40f0407e.html">FAR：Lone Sails</a></div><link rel="stylesheet" type="text/css" href="https://unpkg.com/disqusjs@1.3/dist/disqusjs.css"><script type="text/javascript" src="https://unpkg.com/disqusjs@1.3/dist/disqus.js"></script><script type="text/javascript" id="disqus-count-script">$(function() {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '//disqus.com/next/config.json', true);
  xhr.timeout = 2500;
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 200) {
      $('.post-meta .post-comments-count').show();
      var s = document.createElement('script');
      s.id = 'dsq-count-scr';
      s.src = 'https://zguishen.disqus.com/count.js';
      s.async = true;
      (document.head || document.body).appendChild(s);
    }
  };
  xhr.ontimeout = function () { xhr.abort(); };
  xhr.send(null);
});</script><div class="comments" id="disqus_thread"><script type="text/javascript">// Load comments with DisqusJS
function loadComments() {
  window.dsqjs = new DisqusJS({
    shortname: 'zguishen',
    siteName: 'zguishen\'s blog',
    identifier: 'posts/9c6d1e66.html',
    url: 'https://zguishen.com/posts/9c6d1e66.html',
    title: 'Java21 特性',
    api: '',
    apikey: '',
    admin: '',
    adminLabel: ''
  });
}
// Lazy load {# Credit: https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/comments/disqus.swig #}
(function () {
  var offsetTop = document.getElementById('disqus_thread').offsetTop - window.innerHeight;
  if (offsetTop <= 0) {
    // Load directly when there's no scrollbar
    window.addEventListener('load', loadComments, false);
  } else {
    var disqusScroll = function () {
      // offsetTop may changes because of manually resizing browser window or lazy loading images
      var offsetTop = document.getElementById('disqus_thread').offsetTop - window.innerHeight;
      var scrollTop = window.scrollY;

      // Pre-load comments a bit? (margin or anything else)
      if (offsetTop - scrollTop < 60) {
        window.removeEventListener('scroll', disqusScroll);
        loadComments();
      }
    };
    window.addEventListener('scroll', disqusScroll);
  }
})();
// Scroll to comments automatically if #comment-xxx anchor specified
window.addEventListener('load', function () {
  // I don't know why, it just works.
  window.setTimeout(function () {
    if (location.hash.indexOf('#comment-') !== -1) {
      document.getElementById('disqus_thread').scrollIntoView(true);
    }
  }, 100);
}, false);
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://zguishen.com"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="About"><img class="nofancybox" src="/images/blog/avatar.jpeg"/></a><p>小心，注意，总结，提高。</p><a class="info-icon" href="https://github.com/zgshen" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">技术</a> <a href="/tags/blog/" style="font-size: 15px;">blog</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/KMS/" style="font-size: 15px;">KMS</a> <a href="/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/tags/Office/" style="font-size: 15px;">Office</a> <a href="/tags/Tiddlywiki/" style="font-size: 15px;">Tiddlywiki</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/%E5%8D%8F%E7%A8%8B/" style="font-size: 15px;">协程</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/%E6%92%AD%E5%AE%A2/" style="font-size: 15px;">播客</a> <a href="/tags/%E7%96%AB%E6%83%85/" style="font-size: 15px;">疫情</a> <a href="/tags/%E7%94%9F%E5%AD%98/" style="font-size: 15px;">生存</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 15px;">笔记</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 15px;">游戏</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a> <a href="/tags/%E4%B9%A6%E7%B1%8D/" style="font-size: 15px;">书籍</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 15px;">随笔</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/VPS/" style="font-size: 15px;">VPS</a> <a href="/tags/%E6%B2%BB%E7%96%97/" style="font-size: 15px;">治疗</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 15px;">生活</a> <a href="/tags/COVID-19/" style="font-size: 15px;">COVID-19</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a> <a href="/tags/%E5%B9%BF%E5%B7%9E/" style="font-size: 15px;">广州</a> <a href="/tags/Ubuntu/" style="font-size: 15px;">Ubuntu</a> <a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 15px;">旅行</a> <a href="/tags/Router/" style="font-size: 15px;">Router</a> <a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 15px;">摄影</a> <a href="/tags/%E5%BD%B1%E8%A7%86/" style="font-size: 15px;">影视</a> <a href="/tags/%E5%9F%8E%E5%B8%82/" style="font-size: 15px;">城市</a> <a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size: 15px;">其他</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">博客</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 15px;">面试</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 15px;">转载</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 15px;">基础</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">数据库</a> <a href="/tags/NewFeatures/" style="font-size: 15px;">NewFeatures</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/%E5%81%A5%E5%BA%B7/" style="font-size: 15px;">健康</a> <a href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" style="font-size: 15px;">年终总结</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 15px;">Java基础</a> <a href="/tags/Web%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">Web技术</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/web%E6%A1%86%E6%9E%B6/" style="font-size: 15px;">web框架</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://shanks.link/" title="愿星光伴你左右" target="_blank">愿星光伴你左右</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">zguishen's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo &</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Maupassant. </a> <a rel="nofollow" target="_blank" href="https://foreverblog.cn/go.html"> Wormhole.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>